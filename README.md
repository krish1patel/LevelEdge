# What is LevelEdge

A simple stock prediction system that takes in a ticker, price level, interval, and a datetime to predict for, returning the probability of the price being above the inputted level.

## How the model works

1. Take in inputs
2. Fetch data from yahoo finance
3. Build a DataFrame of technical indicators
4. Calculate the number of candles ahead to predict for and create a target variable
5. Train on several train test splits, recording metrics for performance estimation
6. Retrain using all available data
7. Return prediction on latest data as a probability

# Install

1. Clone the repo
2. `cd LevelEdge`
3. (optional) Create a virtual environment and activate it. `python -m venv venv` `source venv/bin/activate`
4. `pip install -e .`

# Docs

- Import package with `from leveledge import Predictor`
- Initialize an object with `Predictor(ticker, datetime, interval, price)`
  - ticker - string
  - datetime - datetime object, must be timezone aware
  - interval - string, same as yfinance intervals; e.g. '15m', '1h'
  - price - float
- train_xgb()
  - Trains several models using xgboost
- predict_xgb()
  - Generates predictions and returns probability of price being above the inputted level at the inputted datetime

## Example scripts

- `python examples/cli_predictor.py` – Prompts for ticker, target time, interval, and level, then trains and predicts without leaving the terminal.
- `python examples/streamlit_predictor.py` – Launches a Streamlit dashboard so you can tweak the same inputs in a GUI.
- `python examples/batch_option_predictions.py` – Runs predictions for a batch of tickers/levels defined in the script and prints a summary table (handy for comparing setups).
- `streamlit run examples/candlesight_gui.py` – Designer-first CandleSight interface: pick a ticker/interval, see the modern candlestick chart with the glowing direction forecast, and read the probability + return metrics generated by the predictor.

## CandleSight predictor

- The new `CandleSightPredictor` (importable from `leveledge`) ingests a configurable lookback window of intraday candles, derives candlestick ratios/momentum/volatility features, and trains a small ensemble (XGBoost + logistic regression + ridge) that predicts the direction of the next horizon as well as the expected move. The model exposes both probability and price target metadata so the GUI can draw the forecasted path on the candlestick chart.
- Run `python scripts/candlesight_backtest.py` to sanity-check the pipeline: the script trains the predictor for a few names, prints the direction probability, expected return, price target, and a small debug summary that CandleSight can overlay near the candles.

## CandleSight backtests

The scripts under `scripts/` give you a quick way to validate the CandleSight ensemble across different sets of tickers and horizons without wiring up the GUI.

- `python scripts/candlesight_backtest.py` retrains the predictor for each of `AAPL`, `MSFT`, `NVDA`, and `AMZN`, then prints the probability, expected return, price target, and debugging stats for every ticker (great for sanity-checking the default 30m setup).
- `python scripts/candlesight_intraday_backtest.py` runs two intraday configs (`5m` and `1m`) over a ~20-day history for `AAPL`, `MSFT`, `NVDA`, and `GOOGL`, then reports trades, win rates, returns, confidence, ROC AUC, and probability accuracy for each interval + ticker combination.
- `python scripts/candlesight_intraday_backtest_quick.py` keeps each dataset capped at the first 400 windows and focuses on `AAPL` and `GOOGL`, so you can iterate faster while still comparing win/return/ROC metrics.
- `python scripts/candlesight_intraday_backtest_fast.py` limits the dataset further, runs through `AAPL`, `MSFT`, and `GOOGL`, and prints a compact summary per interval for the fastest intraday glance.
- `python scripts/candlesight_strategy_backtest.py` treats CandleSight like a signal-based strategy (win thresholds, returns, ROC, probability accuracy) across `AAPL`, `MSFT`, `NVDA`, `AMZN`, and `GOOGL`, giving you a full strategy-style performance snapshot.

## CLI helper details

- The CLI prints the full list of intervals that `Predictor` accepts (`1m`, `2m`, `5m`, `10m`, `15m`, `30m`, `1h`, `90m`, `1d`) and keeps prompting until you pick one of them.
- Datetimes must be entered in `YYYY-MM-DD HH:MM:SS` format; the script attaches the required `US/Eastern` timezone before calling `Predictor` so you can paste naive local times without worrying about timezone bugs.
- The price prompt enforces numeric input (no stray letters), so you get immediate feedback instead of a stack trace.


# Limitations/Room for improvement

- Doesn't work well and often fails with prices well above or below the current price of a stock
- xgboost model could probably use some tuning
